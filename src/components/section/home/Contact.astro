---
import "@//styles/global.css";
import InputField from "@/components/shared/InputField.astro"

const key = "45cb0791-821b-4d99-ab0c-9eb86d968533";


---

<section id="contact" class="min-h-screen bg-[#1E1B29] flex items-center justify-center px-6 py-20">
  <div class="max-w-3xl w-full text-center">
    <h2 class="text-3xl sm:text-4xl font-bold text-white font-mono mb-6">
      <span class="text-gray-200">03.</span> Contacto
    </h2>
    <p class="text-gray-400 font-mono mb-10">
      Si quieres ponerte en contacto conmigo, completa el siguiente formulario y te responderé lo antes posible.
    </p>

    <form id="contactForm" class="space-y-6 text-left">
      <input type="hidden" name="access_key" value={key} />

      <!-- Nombre -->
      <InputField id="name" type="text" name="name" label="Nombre" placeholder="Tu nombre" />


      <!-- Email -->
      <InputField id="email" type="email" name="email" label="Email" placeholder="tunombre@email.com" />


      <!-- Mensaje -->
      <div>
        <label for="message" class="block text-sm text-gray-200 mb-2 font-mono">Mensaje</label>
        <textarea 
          id="message" name="message" rows="5" required
          class="w-full px-4 py-2 rounded-md border border-gray-500 bg-transparent text-white placeholder-gray-400 focus:outline-none focus:border-[#06B6D4]"
          placeholder="Escribe tu mensaje aquí..."
        ></textarea>
      </div>

      <!-- Botón -->
      <div class="text-center">
        <button 
          type="submit"
          class="px-6 py-2 border-2 border-white rounded-md transition-all duration-300 
                 hover:bg-white hover:text-[#1E1B29] font-dev text-white"
        >
          Enviar
        </button>
      </div>
    </form>
  </div>

  <!-- Toast container -->
  <div id="toast" class="hidden fixed bottom-6 right-6 px-4 py-3 rounded-md shadow-lg font-mono text-white"></div>
</section>

<script>
  const form = document.getElementById("contactForm")! as HTMLFormElement;
  const toast = document.getElementById("toast")! as HTMLFormElement;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);

    const res = await fetch("https://api.web3forms.com/submit", {
      method: "POST",
      body: formData
    });
    const data = await res.json();

    // Mostrar toast
    toast.classList.remove("hidden");
    toast.textContent = data.success 
      ? "✅ ¡Tu mensaje fue enviado con éxito!"
      : "❌ Hubo un error al enviar. Intenta de nuevo.";
    toast.className = `fixed bottom-6 right-6 px-4 py-3 rounded-md shadow-lg font-mono text-white transition 
      ${data.success ? "bg-green-600" : "bg-red-600"}`;

    if (data.success) form.reset();

    // Ocultar después de 3s
    setTimeout(() => {
      toast.classList.add("hidden");
    }, 3000);
  });
</script>
